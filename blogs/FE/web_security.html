<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器安全 | Aki Huang 🤔👊💪✍️👀👨‍💻‍ </title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="让正确的事情持续发生">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.37f5b436.css" as="style"><link rel="preload" href="/assets/js/app.80a51cbd.js" as="script"><link rel="preload" href="/assets/js/3.866e4f03.js" as="script"><link rel="preload" href="/assets/js/1.7045c4ac.js" as="script"><link rel="preload" href="/assets/js/13.c292de88.js" as="script"><link rel="prefetch" href="/assets/js/10.365b4db5.js"><link rel="prefetch" href="/assets/js/11.34e095a2.js"><link rel="prefetch" href="/assets/js/12.430cde5b.js"><link rel="prefetch" href="/assets/js/14.4a3f6877.js"><link rel="prefetch" href="/assets/js/15.38b88e29.js"><link rel="prefetch" href="/assets/js/16.31bd5c64.js"><link rel="prefetch" href="/assets/js/17.daad4b8b.js"><link rel="prefetch" href="/assets/js/18.e3e06284.js"><link rel="prefetch" href="/assets/js/19.1bc28518.js"><link rel="prefetch" href="/assets/js/20.8895da36.js"><link rel="prefetch" href="/assets/js/21.ee2acf3b.js"><link rel="prefetch" href="/assets/js/22.7398653a.js"><link rel="prefetch" href="/assets/js/23.fc2060a7.js"><link rel="prefetch" href="/assets/js/24.24ca444b.js"><link rel="prefetch" href="/assets/js/25.19ff3f14.js"><link rel="prefetch" href="/assets/js/26.65e0fd28.js"><link rel="prefetch" href="/assets/js/27.45c91ba7.js"><link rel="prefetch" href="/assets/js/28.69b45243.js"><link rel="prefetch" href="/assets/js/29.dcfa2922.js"><link rel="prefetch" href="/assets/js/30.d85b5ffd.js"><link rel="prefetch" href="/assets/js/31.ad1cbd2c.js"><link rel="prefetch" href="/assets/js/32.6b4fc1a5.js"><link rel="prefetch" href="/assets/js/33.551034c5.js"><link rel="prefetch" href="/assets/js/34.3ee084e6.js"><link rel="prefetch" href="/assets/js/35.87f33c96.js"><link rel="prefetch" href="/assets/js/36.d3034847.js"><link rel="prefetch" href="/assets/js/4.96d17649.js"><link rel="prefetch" href="/assets/js/5.e91fcb07.js"><link rel="prefetch" href="/assets/js/6.0ae3694f.js"><link rel="prefetch" href="/assets/js/7.45036660.js"><link rel="prefetch" href="/assets/js/8.9427c83c.js"><link rel="prefetch" href="/assets/js/9.43e418a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37f5b436.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Aki Huang 🤔👊💪✍️👀👨‍💻‍ </h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>让正确的事情持续发生</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Aki Huang</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Aki Huang 🤔👊💪✍️👀👨‍💻‍ " class="logo"> <span class="site-name">Aki Huang 🤔👊💪✍️👀👨‍💻‍ </span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Data Structures and Algorithms/" class="nav-link"><i class="undefined"></i>
  Data Structures and Algorithms
</a></li><li class="dropdown-item"><!----> <a href="/categories/FrontEnd/" class="nav-link"><i class="undefined"></i>
  FrontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/Think/" class="nav-link"><i class="undefined"></i>
  Think
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huangzonggui/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/870468940997319" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Aki Huang
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>24</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>23</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Data Structures and Algorithms/" class="nav-link"><i class="undefined"></i>
  Data Structures and Algorithms
</a></li><li class="dropdown-item"><!----> <a href="/categories/FrontEnd/" class="nav-link"><i class="undefined"></i>
  FrontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/Think/" class="nav-link"><i class="undefined"></i>
  Think
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huangzonggui/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/870468940997319" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>浏览器安全</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Aki Huang</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">浏览器安全</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Aki Huang</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2/22/2022</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/blogs/FE/web_security.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>安全</span></i></div></div> <div class="theme-reco-content content__default"><p>浏览器安全可分为</p> <ul><li>Web 页面安全</li> <li>浏览器网络安全</li> <li>浏览器系统安全</li></ul> <h1 id="web-页面安全"><a href="#web-页面安全" class="header-anchor">#</a> Web 页面安全</h1> <p>同源策略、CSP(Content-Security-Policy) 和 CORS(Cross-Origin Resource Sharing) 之间的关系</p> <ul><li>同源策略是浏览器的一个安全机制，使用 XMLHttpRequest 和 Fetch 都是无法直接进行跨域请求的，
但是页面可以引用第三方资源（如：img，js，css，html），这样就会暴露一些 XSS 攻击的安全。CSP 是浏览器为了解决 XSS 攻击引入的一个安全策略
<ul><li>CSP 核心思想：让服务器决定浏览器能够加载哪些资源，决定浏览器是否能够执行内联 JavaScript 代码</li></ul></li> <li>XMLHttpRequest 和 fetch 是无法访问不同域的数据的，因此浏览器又引入了 CORS(跨域资源共享)策略，让其可以安全的进行跨域操作
<ul><li>服务器配置 Access-Control-Origin-Allow: 允许跨域的域名</li></ul></li></ul> <p>参考答案：</p> <p>同源策略、CSP 和 CORS 之间的关系：</p> <p>同源策略就是说同源页面随你瞎搞，但是不同源之间想瞎搞只能通过浏览器提供的手段来搞</p> <p>比如说</p> <ol><li>读取数据和操作 DOM 要用跨文档机制</li> <li>跨域请求要用 CORS 机制</li> <li>引用第三方资源要用 CSP</li></ol> <h2 id="跨站脚本-xss-cross-site-scripting-攻击"><a href="#跨站脚本-xss-cross-site-scripting-攻击" class="header-anchor">#</a> 跨站脚本（XSS: Cross Site Scripting）攻击</h2> <p>恶意脚本可以做</p> <ul><li>通过<code>document.cookie</code>窃取 Cookie 信息。做一些登录后的恶意操作。</li> <li>通过<code>addEventListener</code>监听键盘的输入。例如窃取信用卡账号和密码并发送到黑客服务器。</li> <li>通过<code>修改 DOM</code>伪造登录窗口，欺骗用户名和密码等信息。</li> <li>嵌入浮窗广告。</li></ul> <p>分类</p> <h3 id="存储型-xss-攻击-涉及服务器"><a href="#存储型-xss-攻击-涉及服务器" class="header-anchor">#</a> 存储型 XSS 攻击（涉及服务器）</h3> <p>攻击步骤</p> <ol><li>将恶意代码提交到<strong>服务器数据库</strong>中存储（例如通过表单输入脚本代码）</li> <li>页面请求第一步提交的数据，数据库返回恶意代码</li> <li>用户浏览此页面时，恶意代码会运行（将用户的 Cookie 信息等数据上传到攻击者服务器）。</li></ol> <p>预防</p> <ol><li>对 Cookie 设置 httpOnly ，只允许 http 请求使用，document.cookie 无法获取</li> <li>在前端后端提交数据和保存数据的时候，将数据过滤或转码，脚本的代码会转成普通的字符串</li></ol> <h3 id="反射型-xss-攻击-涉及服务器"><a href="#反射型-xss-攻击-涉及服务器" class="header-anchor">#</a> 反射型 XSS 攻击（涉及服务器）</h3> <p>Web 服务器接收到请求时，又将恶意代码<strong>反射</strong>给了浏览器端</p> <ol><li>攻击者通过将恶意代码构造到特殊的 URL中</li> <li>用户点击 URL，服务器将恶意代码从 URL 中取出拼接在 HTML 中返回给浏览器</li> <li>用户解析 HTML 执行，恶意代码被执行</li> <li>恶意代码将用户信息发送到攻击者服务器，或者冒充用户的行为，恶意调用目标网站接口执行攻击者指定的操作</li></ol> <blockquote><p>反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。</p></blockquote> <p>预防</p> <ol><li>对内容进行过滤或转码</li> <li>利用 CSP(Content-Security-Policy)，控制浏览器能够加载哪些资源，决定浏览器只能够执行内联 JavaScript 代码
<ul><li>限制加载其他域下的资源文件 eg: <code>Content-Security-Policy: default-src 'self'</code></li> <li>禁止第三方域提交数据，防止用户数据泄露</li> <li>禁止执行内联脚本和未授权的脚本</li> <li>提供了上报机制，可尽快发现 XSS 攻击</li></ul></li> <li>使用 HttpOnly 属性</li></ol> <h3 id="基于-dom-的-xss-攻击-不涉及服务器"><a href="#基于-dom-的-xss-攻击-不涉及服务器" class="header-anchor">#</a> 基于 DOM 的 XSS 攻击（不涉及服务器）</h3> <p>在 Web 资源传输过程中，修改 HTML 页面（网络劫持）</p> <ul><li>通过 WiFi 路由器劫持</li> <li>通过本地恶意软件劫持</li></ul> <p>预防 DOM 型 XSS 攻击</p> <ul><li>使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>document.write</code> 时确保数据可信</li> <li>避免在字符串中拼接不可信数据</li></ul> <p>实践: 安全检测报告
<img src="/assets/img/2022-02-22-11-26-00.9647f3a4.png" alt=""></p> <p>安全检测工具：https://www.zaproxy.org/</p> <h3 id="xss-攻击总结"><a href="#xss-攻击总结" class="header-anchor">#</a> XSS 攻击总结</h3> <blockquote><p>这三种攻击方式的共同点是都需要往用户的页面中注入恶意脚本，然后再通过恶意脚本将用户数据上传到黑客的恶意服务器上。而三者的不同点在于注入的方式不一样，有通过服务器漏洞来进行注入的，还有在客户端直接注入的。</p></blockquote> <blockquote><p>主要有三种防范策略，第一种是通过服务器对输入的内容进行过滤或者转码，第二种是充分利用好 CSP，第三种是使用 HttpOnly 来保护重要的 Cookie 信息。</p></blockquote> <p>转账等安全性要求高的操作，通过<strong>添加验证码</strong>添加安全性</p> <h2 id="跨站请求伪造-csrf-cross-site-request-forgery"><a href="#跨站请求伪造-csrf-cross-site-request-forgery" class="header-anchor">#</a> 跨站请求伪造（CSRF: Cross-site request forgery）</h2> <p><strong>什么是 CSRF 攻击</strong></p> <p>攻击者诱导用户打开第三方网站（攻击者网站），在第三方网站中通过伪造请求登录网站，从而利用用户的<strong>登录状态</strong>发起跨站请求，做一些恶意行为。</p> <p>为什么从登录的网站打开第三方网站，第三方可以使用到登录网站的登录状态？</p> <ul><li>没设置 SameSite 情况下，登录站点A.com后（此时有登录状态）</li> <li>诱导跳转到站点B，站点B中做了一些向A.com站点请求的伪造请求（img 或 form的请求，这些请求不受跨域限制）：A.com/act=xxx。此时浏览器会默认携带 A.com 的登录状态（Cookie）
（浏览器处理cookie的机制，做某个域的请求，自动会把这个域的cookie带上）</li></ul> <h3 id="get-类型的-csrf"><a href="#get-类型的-csrf" class="header-anchor">#</a> GET 类型的 CSRF</h3> <p>在攻击者页面的 HTML 代码中，将恶意请求隐藏在 <code>img</code> 标签内，当页面加载时，自动发起 <code>Get</code> 请求</p> <h3 id="post-类型的-csrf"><a href="#post-类型的-csrf" class="header-anchor">#</a> POST 类型的 CSRF</h3> <p>在攻击者页面的 HTML 代码中，将恶意请求伪造在 <code>form</code> 标签中，用脚本提交 <code>document.getElementById('form').submit()</code></p> <h3 id="诱导用户点击链接类型的-csrf"><a href="#诱导用户点击链接类型的-csrf" class="header-anchor">#</a> 诱导用户点击链接类型的 CSRF</h3> <p>在攻击者页面中，防止一个诱导 A 标签，实际 <code>href</code> 是攻击操作。需要用户点击链接才会触发</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker&quot;</span> taget<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span><span class="token operator">&gt;</span>
  重磅消息！！
  <span class="token operator">&lt;</span>a<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="预防"><a href="#预防" class="header-anchor">#</a> 预防</h3> <p>CSRF 的特点</p> <ul><li>CSRF (通常)发生在第三方域名</li> <li>CSRF 攻击者不能窃取到 Cookie 信息，只是使用</li></ul> <p>针对 CSRF 的特点，指定防护策略：</p> <ul><li>阻止不明外域访问
<ul><li>同源检测</li> <li>Samesite Cookie</li></ul></li> <li>提交时要求附加本域才能获取到的信息
<ul><li>CSRF Token</li> <li>双重 Cookie 验证</li></ul></li></ul> <p><strong>具体策略</strong></p> <ol><li><p>利用 Cookie 的 SameSite 属性</p> <ul><li><code>SameSite=Strict</code> 浏览器完全禁止第三方 <code>Cookie</code> <blockquote><p>如果你从极客时间的页面中访问 InfoQ 的资源
，而 InfoQ 的某些 Cookie 设置了 SameSite = Strict 的话，
那么这些 Cookie 是不会被发送到 InfoQ 的服务器上的。
只有你从 InfoQ 的站点去请求 InfoQ 的资源时，才会带上这些 Cookie。</p></blockquote></li> <li><code>SameSite=Lax</code> <blockquote><p>在跨站点的情况下，从第三方站点的链接打开和从第三方站点提交 Get 方式的表单这两种方式都会携带 Cookie。但如果在第三方站点中使用 Post 方法，或者通过 img、iframe 等标签加载的 URL，这些场景都不会携带 Cookie。</p></blockquote></li> <li><code>SameSite=none</code> 在任意情况都会发送 Cookie 数据</li></ul></li> <li><p>服务器验证请求的来源站点</p></li></ol> <blockquote><p>Referer 是 HTTP 请求头中的一个字段，记录了该 HTTP 请求的来源地址</p></blockquote> <p><img src="/assets/img/2022-02-22-21-55-15.770bb89d.png" alt=""></p> <blockquote><p>Origin 属性只包含了域名信息，并没有包含具体的 URL 路径，这是 Origin 和 Referer 的一个主要区别
Origin 的值之所以不包含详细路径信息，是有些站点因为安全考虑，不想把源站点的详细路径暴露给服务器。</p></blockquote> <p>服务器的策略是优先判断 Origin，如果请求头中没有包含 Origin 属性，再根据实际情况判断是否使用 Referer 值</p> <ol start="3"><li>CSRF Token
<ul><li>浏览器向服务器发起请求，服务器返回一个 CSRF Token，植入到页面中</li> <li>浏览器如果要发起类似“转账”类的请求，需要携带 CSRF Token，服务器验证 Token 是否合法。
<img src="/assets/img/2022-02-22-22-06-57.50dd67b0.png" alt=""></li></ul></li></ol> <h2 id="web-网页安全总结"><a href="#web-网页安全总结" class="header-anchor">#</a> Web 网页安全总结</h2> <p>Web 安全问题主要原因是浏览器为同源策略开的两个后门</p> <ul><li>页面中可以任意引用第三方资源</li> <li>通过 CORS 策略让 XMLHttpRequest 和 Fetch 去跨域请求资源</li></ul> <p>为了解决这些问题，</p> <ul><li>引入了 <code>CSP</code> 来限制页面任意引入外部资源</li> <li>引入了 <code>HttpOnly</code> 机制来禁止 <code>JavaScript</code> 通过 <code>document.cookies</code> 的读取</li> <li>引入了 <code>SameSite</code> 和 <code>Origin</code> 来防止 <code>CSRF</code> 攻击</li></ul> <h1 id="浏览器网络安全"><a href="#浏览器网络安全" class="header-anchor">#</a> 浏览器网络安全</h1> <h1 id="浏览器系统安全"><a href="#浏览器系统安全" class="header-anchor">#</a> 浏览器系统安全</h1> <p>参考文章：</p> <ul><li><a href="https://time.geekbang.org/column/article/151370" target="_blank" rel="noopener noreferrer">32 | 同源策略：为什么XMLHttpRequest不能跨域请求资源？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://time.geekbang.org/column/article/152807" target="_blank" rel="noopener noreferrer">33 | 跨站脚本攻击（XSS）：为什么Cookie中有HttpOnly属性？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://time.geekbang.org/column/article/154110" target="_blank" rel="noopener noreferrer">34 | CSRF攻击：陌生链接不要随便点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener noreferrer">前端安全系列（一）：如何防止XSS攻击<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止CSRF攻击？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/8/2023, 3:26:25 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/FE/web_security.html#跨站脚本-xss-cross-site-scripting-攻击" class="sidebar-link reco-side-跨站脚本-xss-cross-site-scripting-攻击" data-v-70334359>跨站脚本（XSS: Cross Site Scripting）攻击</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#存储型-xss-攻击-涉及服务器" class="sidebar-link reco-side-存储型-xss-攻击-涉及服务器" data-v-70334359>存储型 XSS 攻击（涉及服务器）</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#反射型-xss-攻击-涉及服务器" class="sidebar-link reco-side-反射型-xss-攻击-涉及服务器" data-v-70334359>反射型 XSS 攻击（涉及服务器）</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#基于-dom-的-xss-攻击-不涉及服务器" class="sidebar-link reco-side-基于-dom-的-xss-攻击-不涉及服务器" data-v-70334359>基于 DOM 的 XSS 攻击（不涉及服务器）</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#xss-攻击总结" class="sidebar-link reco-side-xss-攻击总结" data-v-70334359>XSS 攻击总结</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/web_security.html#跨站请求伪造-csrf-cross-site-request-forgery" class="sidebar-link reco-side-跨站请求伪造-csrf-cross-site-request-forgery" data-v-70334359>跨站请求伪造（CSRF: Cross-site request forgery）</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#get-类型的-csrf" class="sidebar-link reco-side-get-类型的-csrf" data-v-70334359>GET 类型的 CSRF</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#post-类型的-csrf" class="sidebar-link reco-side-post-类型的-csrf" data-v-70334359>POST 类型的 CSRF</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#诱导用户点击链接类型的-csrf" class="sidebar-link reco-side-诱导用户点击链接类型的-csrf" data-v-70334359>诱导用户点击链接类型的 CSRF</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/web_security.html#预防" class="sidebar-link reco-side-预防" data-v-70334359>预防</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/web_security.html#web-网页安全总结" class="sidebar-link reco-side-web-网页安全总结" data-v-70334359>Web 网页安全总结</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.80a51cbd.js" defer></script><script src="/assets/js/3.866e4f03.js" defer></script><script src="/assets/js/1.7045c4ac.js" defer></script><script src="/assets/js/13.c292de88.js" defer></script>
  </body>
</html>
