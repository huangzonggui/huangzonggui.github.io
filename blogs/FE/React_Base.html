<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React基础知识和原理 | Aki Huang 🤔👊💪✍️👀👨‍💻‍ </title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="让正确的事情持续发生">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.37f5b436.css" as="style"><link rel="preload" href="/assets/js/app.a6f77771.js" as="script"><link rel="preload" href="/assets/js/3.7f2c89d8.js" as="script"><link rel="preload" href="/assets/js/1.7045c4ac.js" as="script"><link rel="preload" href="/assets/js/28.66456a8e.js" as="script"><link rel="prefetch" href="/assets/js/10.3d6d9b99.js"><link rel="prefetch" href="/assets/js/11.6bffa02c.js"><link rel="prefetch" href="/assets/js/12.4259a4c9.js"><link rel="prefetch" href="/assets/js/13.56019218.js"><link rel="prefetch" href="/assets/js/14.5d445bf2.js"><link rel="prefetch" href="/assets/js/15.ad49d11a.js"><link rel="prefetch" href="/assets/js/16.1a7f0f66.js"><link rel="prefetch" href="/assets/js/17.6cedc9e6.js"><link rel="prefetch" href="/assets/js/18.c6d158a4.js"><link rel="prefetch" href="/assets/js/19.d7a8dff5.js"><link rel="prefetch" href="/assets/js/20.189ed124.js"><link rel="prefetch" href="/assets/js/21.0c31ad1d.js"><link rel="prefetch" href="/assets/js/22.009bdddb.js"><link rel="prefetch" href="/assets/js/23.5e4eda22.js"><link rel="prefetch" href="/assets/js/24.c708ac7a.js"><link rel="prefetch" href="/assets/js/25.d8cb76d2.js"><link rel="prefetch" href="/assets/js/26.57676e98.js"><link rel="prefetch" href="/assets/js/27.abafb5c9.js"><link rel="prefetch" href="/assets/js/29.f5944f68.js"><link rel="prefetch" href="/assets/js/30.6b783f98.js"><link rel="prefetch" href="/assets/js/31.36117798.js"><link rel="prefetch" href="/assets/js/32.1f3b9c0b.js"><link rel="prefetch" href="/assets/js/33.731e8ec3.js"><link rel="prefetch" href="/assets/js/4.e77bf8e0.js"><link rel="prefetch" href="/assets/js/5.7fd364b0.js"><link rel="prefetch" href="/assets/js/6.689cd122.js"><link rel="prefetch" href="/assets/js/7.ae42653a.js"><link rel="prefetch" href="/assets/js/8.379e54ce.js"><link rel="prefetch" href="/assets/js/9.ffd35c14.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37f5b436.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Aki Huang 🤔👊💪✍️👀👨‍💻‍ </h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>让正确的事情持续发生</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Aki Huang</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Aki Huang 🤔👊💪✍️👀👨‍💻‍ " class="logo"> <span class="site-name">Aki Huang 🤔👊💪✍️👀👨‍💻‍ </span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Data Structures and Algorithms/" class="nav-link"><i class="undefined"></i>
  Data Structures and Algorithms
</a></li><li class="dropdown-item"><!----> <a href="/categories/FrontEnd/" class="nav-link"><i class="undefined"></i>
  FrontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/Think/" class="nav-link"><i class="undefined"></i>
  Think
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huangzonggui/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/870468940997319" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Aki Huang
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>21</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>20</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Data Structures and Algorithms/" class="nav-link"><i class="undefined"></i>
  Data Structures and Algorithms
</a></li><li class="dropdown-item"><!----> <a href="/categories/FrontEnd/" class="nav-link"><i class="undefined"></i>
  FrontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/Think/" class="nav-link"><i class="undefined"></i>
  Think
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huangzonggui/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/870468940997319" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="huangzonggui huangzonggui-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>React基础知识和原理</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Aki Huang</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">React基础知识和原理</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Aki Huang</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>12/12/2021</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/blogs/FE/React_Base.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>React</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="🤔思考"><a href="#🤔思考" class="header-anchor">#</a> 🤔思考</h1> <ul><li>组件之间如何通讯</li> <li>JSX的本质是什么</li> <li>Context是什么？如何应用？</li> <li>shouldComponentUpdate用途</li> <li>redux单向数据流画图表示</li> <li>setState场景题
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/557ac554f12e4973a0cdb958e4290821~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></li> <li>什么是纯函数</li> <li>React组件生命周期</li> <li>React发起ajax应该在哪个生命周期</li> <li>渲染列表，为何使用key</li> <li>函数组件和class组件的区别</li> <li>什么是受控组件</li> <li>何时使用异步组件</li> <li>多个组件有公共逻辑，如何抽离</li> <li>redux如何进行异步请求</li> <li>react-router如何配置懒加载
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a25c6bf75f645119792946ea1ccd305~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></li> <li>React 中 <strong>Function Component 与 Class Component 有何不同？</strong></li> <li>PureComponent有何区别</li> <li>React事件和DOM事件的区别</li> <li>React性能优化</li> <li>React和Vue的区别</li></ul> <h1 id="react-基础、使用"><a href="#react-基础、使用" class="header-anchor">#</a> React 基础、使用</h1> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <h3 id="jsx基础知识点"><a href="#jsx基础知识点" class="header-anchor">#</a> JSX基础知识点</h3> <ul><li>变量、插值</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>表达式</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>flag <span class="token operator">?</span> <span class="token string">'yes'</span> <span class="token operator">:</span> <span class="token string">'no'</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>设置 class name</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> classElem <span class="token operator">=</span> <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span>设置 css <span class="token keyword">class</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>子元素和组件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子元素</span>
<span class="token keyword">const</span> imgElem <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我的头像<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;xxxx.png&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>imgUrl<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>style</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// style</span>
<span class="token keyword">const</span> styleData <span class="token operator">=</span> <span class="token punctuation">{</span> fontSize<span class="token operator">:</span> <span class="token string">'30px'</span><span class="token punctuation">,</span>  color<span class="token operator">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> styleElem <span class="token operator">=</span> <span class="token operator">&lt;</span>p style<span class="token operator">=</span><span class="token punctuation">{</span>styleData<span class="token punctuation">}</span><span class="token operator">&gt;</span>设置 style<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token comment">// 内联写法，注意 {{ 和 }}</span>
<span class="token comment">// const styleElem = &lt;p style={{ fontSize: '30px',  color: 'blue' }}&gt;设置 style&lt;/p&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>插入原生 HTML
<ul><li>有跨站脚本攻击（XSS）的风险，不建议使用</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 原生 html</span>
<span class="token keyword">const</span> rawHtml <span class="token operator">=</span> <span class="token string">'&lt;span&gt;富文本内容&lt;i&gt;斜体&lt;/i&gt;&lt;b&gt;加粗&lt;/b&gt;&lt;/span&gt;'</span>
<span class="token keyword">const</span> rawHtmlData <span class="token operator">=</span> <span class="token punctuation">{</span>
	__html<span class="token operator">:</span> rawHtml <span class="token comment">// 注意，必须是这种格式</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> rawHtmlElem <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>p dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span>rawHtmlData<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>rawHtml<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token keyword">return</span> rawHtmlElem
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>插入例子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createMarkup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span> __html<span class="token operator">:</span> <span class="token string">'&lt;img src=&quot;empty.png&quot; onerror =&quot;alert(\'xss\')&quot;/&gt;'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">createMarkup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7e8c88f79684cdab6d36fca009736fe~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <h3 id="jsx如何判断条件和渲染列表"><a href="#jsx如何判断条件和渲染列表" class="header-anchor">#</a> JSX如何判断条件和渲染列表</h3> <ul><li>if else</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme <span class="token operator">===</span> <span class="token string">'dark'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>dark<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>not dark<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>三元表达式</li> <li>逻辑运算符 &amp;&amp; ||</li></ul> <p>与 Vue 不同，v-if v-else</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;type === 'A'&quot;</span><span class="token operator">&gt;</span> <span class="token constant">A</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;type === 'B'&quot;</span><span class="token operator">&gt;</span> <span class="token constant">B</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;type === 'C'&quot;</span><span class="token operator">&gt;</span> <span class="token constant">C</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span> Not <span class="token constant">A</span><span class="token operator">/</span><span class="token constant">B</span><span class="token operator">/</span><span class="token constant">C</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>渲染列表
<ul><li>map with key</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>index<span class="token operator">:</span> <span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="react事件为何bind-this"><a href="#react事件为何bind-this" class="header-anchor">#</a> React事件为何bind this</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

        <span class="token comment">// 修改方法的 this 指向</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>clickHandler1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clickHandler1</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">clickHandler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// console.log('this....', this) // this 默认是 undefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			name<span class="token operator">:</span> <span class="token string">'lisi'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 箭头函数里没有 this, 往上一级找 静态方法，this 指向当前实例，所以不用 bind</span>
    <span class="token function-variable function">clickHandler2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'lisi'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="react-event-事件和-dom-事件的区别"><a href="#react-event-事件和-dom-事件的区别" class="header-anchor">#</a> React event 事件和 DOM 事件的区别</h3> <ol><li>event 不是原生事件， 是 SyntheticEvent，模拟 DOM 事件的所有能力
<ul><li>SyntheticEvent 合成事件：为了适配各个浏览器，react 封装了原生事件为合成事件</li></ul></li> <li>event.nativeEvent 是原生事件对象</li> <li>React 16 之前，所有事件都挂载到 DOCUMENT 上，React 17 所有事件都挂载到 ROOT ELEMENT 上
<ul><li>有利于多个 React 版本共存，例如 <code>微前端</code> <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c69783ea7e949cba87b4c9e226409b7~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></li></ul></li> <li>和 DOM 事件不一样，和 VUE 事件也不一样</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">// 获取 event</span>
  <span class="token function-variable function">clickHandler3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// event.preventDefault(); // 阻止默认行为</span>
    <span class="token comment">//    event.stopPropagation(); // 阻止冒泡</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指向当前元素，即当前元素触发</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;current target&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指向当前元素，假象！！！</span>

    <span class="token comment">// 注意，event 其实是 React 封装的。可以看 __proto__.constructor 是 SyntheticEvent 组合事件</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;event&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不是原生的 Event ，原生的 MouseEvent</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;event.__proto__.constructor&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token class-name">__proto__</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 原生 event 如下。其 __proto__.constructor 是 MouseEvent</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;nativeEvent&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;nativeEvent target&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指向当前元素，即当前元素触发</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;nativeEvent current target&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// React 16 之前，所有事件都挂载到 DOCUMENT 上，React 17 所有事件都挂载到 ROOT ELEMENT 上</span>
    <span class="token comment">//  有利于多个 React 版本共存，例如 `微前端`</span>

    <span class="token comment">// 1. event 是 SyntheticEvent ，模拟出来 DOM 事件所有能力</span>
    <span class="token comment">// 2. event.nativeEvent 是原生事件对象</span>
    <span class="token comment">// 3. 所有的事件，都被挂载到 document 上</span>
    <span class="token comment">// 4. 和 DOM 事件不一样，和 Vue 事件也不一样</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><a href="https://codepen.io/huangzonggui/pen/MWEbyaZ" target="_blank" rel="noopener noreferrer">let me try<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>与 Vue 比较</p> <ol><li>event 是原生的</li> <li>事件被挂载到当前元素</li> <li>和 DOM 事件一样</li></ol> <ul><li>传递参数
<ul><li>最后追加一个参数，即可接收 event</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">// 传递参数</span>
  <span class="token function">clickHandler4</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;event&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最后追加一个参数，即可接收 event</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="react-表单知识点"><a href="#react-表单知识点" class="header-anchor">#</a> React 表单知识点</h3> <ol><li><p>受控组件</p> <ul><li>可以简单理解为： input 受 state 控制，通过 onChange 手动修改 state 的值<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">&quot;inputName&quot;</span><span class="token operator">&gt;</span>姓名：<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 用 htmlFor 代替 for */</span><span class="token punctuation">}</span>
		<span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">&quot;inputName&quot;</span> value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onInputChange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">onInputChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		name<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul></li> <li><p>input textarea select 使用 value</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onTextareaChange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>city<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onSelectChange<span class="token punctuation">}</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;beijing&quot;</span><span class="token operator">&gt;</span>北京<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;shanghai&quot;</span><span class="token operator">&gt;</span>上海<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">&quot;shenzhen&quot;</span><span class="token operator">&gt;</span>深圳<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>checkbox radio 使用 checked</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span> checked<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>flag<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onCheckboxChange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
	male <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;radio&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;gender&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;male&quot;</span> checked<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>gender <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRadioChange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	female <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;radio&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;gender&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;female&quot;</span> checked<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>gender <span class="token operator">===</span> <span class="token string">'female'</span><span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRadioChange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>gender<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h3 id="react父子组件通讯"><a href="#react父子组件通讯" class="header-anchor">#</a> React父子组件通讯</h3> <ul><li>父组件可以给子组件传递<code>数据</code>或<code>方法</code></li> <li>在子组件中，通过 this.props 获取父组件传递的数据</li> <li>状态提升：react 组件中，在公共的父组件中定义变量</li></ul> <h3 id="setstate-为何使用不可变值"><a href="#setstate-为何使用不可变值" class="header-anchor">#</a> setState 为何使用不可变值</h3> <ul><li>不可变值
<ul><li>不要直接修改 state</li> <li>不改变数组的函数
<ul><li><code>concat slice map filter reduce</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> oldArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldArr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// [1, 2, 3, 100]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldArr<span class="token punctuation">)</span><span class="token comment">// [1, 2, 3]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>改变数组的函数：<code>push pop unshift shift forEach reverse</code></li></ul></li></ul> <p><a href="https://juejin.cn/post/6844904192671219719" target="_blank" rel="noopener noreferrer">js 改变原数组和不改变原数组的方法整理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="setstate-是同步的还是异步的"><a href="#setstate-是同步的还是异步的" class="header-anchor">#</a> setState 是同步的还是异步的</h3> <ul><li>异步：直接使用时</li> <li>同步：setState 回调中可以获取到修改后的值<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count by callback'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token comment">// 回调可以拿到最新值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count by callback'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token comment">// 异步的，拿不到最新值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>同步： setTimeout 中 setState 是同步<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count in setTimeout'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h3 id="setstate何时会合并state"><a href="#setstate何时会合并state" class="header-anchor">#</a> setState何时会合并state</h3> <ul><li>传入对象，会被合并（类似使用了 Object.assign）</li> <li>传入函数，不会被合并</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 传入对象，会被合并（类似 Object.assign ）。执行结果只一次 +1</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

 <span class="token comment">// 传入函数，不会被合并。执行结果是 +3</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count2 <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count2 <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count2 <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="react-component-组件生命周期"><a href="#react-component-组件生命周期" class="header-anchor">#</a> React Component 组件生命周期</h3> <p><a href="https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" target="_blank" rel="noopener noreferrer">参考网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8db313ac44314fd781f8862687f72e25~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <h4 id="render-阶段和-commit-阶段"><a href="#render-阶段和-commit-阶段" class="header-anchor">#</a> Render 阶段和 Commit 阶段</h4> <p>Render 阶段</p> <ul><li>生成 VDOM</li></ul> <blockquote><p>Render 阶段是 React 根据组件的状态和属性计算出组件的新视图的过程。
在 Render 阶段中，React 会执行组件的 render 方法，生成 Virtual DOM 对象。
在此过程中，React 还会比较前一次的 Virtual DOM 对象和新生成的 Virtual DOM 对象之间的差异，
也就是所谓的 <code>Reconciliation</code>（协调）算法，找出需要进行 DOM 操作的地方。</p></blockquote> <p>Commit 阶段</p> <ul><li>提交 VDOM 的变化</li></ul> <blockquote><p>commit 阶段是将 React 的 Virtual DOM 映射到真实的 DOM 上的过程。在 commit 阶段中，
React 会根据前面 Render 阶段中计算出的需要进行 DOM 操作的地方，更新真实的 DOM，完成页面的渲染。</p></blockquote> <blockquote><p>Render 阶段中的所有操作都是在虚拟 DOM 中进行的，真实的 DOM 并没有被操作。而 commit 阶段
则是将虚拟 DOM 的变化映射到真实 DOM 上的过程。这种分离的设计可以最小化 DOM 操作的次数，提高页面的渲染效率。</p></blockquote> <h4 id="版本组件生命周期"><a href="#版本组件生命周期" class="header-anchor">#</a> 版本组件生命周期</h4> <ul><li><p>React 16前、16.3、&gt;= 16.4的生命周期</p> <ul><li><a href="https://juejin.cn/post/6844903886436696077#heading-16" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844903886436696077#heading-16<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p><a href="https://www.cnblogs.com/soyxiaobi/p/9559117.html" target="_blank" rel="noopener noreferrer">A B C 嵌套组件的生命周期<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="单个组件的声明周期"><a href="#单个组件的声明周期" class="header-anchor">#</a> 单个组件的声明周期</h4> <ul><li>挂载
<ul><li>constructor</li> <li>componentDidMount</li></ul></li> <li>更新（render: new props、new state、forceUpdate）
<ul><li>shouldComponentUpdate</li> <li>componentDidUpdate</li></ul></li> <li>卸载
<ul><li>componentWillUnmount</li></ul></li></ul> <h4 id="hooks模拟生命周期"><a href="#hooks模拟生命周期" class="header-anchor">#</a> hooks模拟生命周期</h4> <p>模拟：</p> <ul><li>DidMount</li> <li>DidUpdate</li> <li>WillUnMount</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>    // // 模拟 class 组件的 DidMount 和 DidUpdate
    // useEffect(() =&gt; {
    //     console.log('在此发送一个 ajax 请求')
    // })

    // // 模拟 class 组件的 DidMount
    // useEffect(() =&gt; {
    //     console.log('加载完了')
    // }, []) // 第二个参数是 [] （不依赖于任何 state）

    // // 模拟 class 组件的 DidUpdate
    // useEffect(() =&gt; {
    //     console.log('更新了')
    // }, [count, name]) // 第二个参数就是依赖的 state

    // 模拟 class 组件的 DidMount
    useEffect(() =&gt; {
        let timerId = window.setInterval(() =&gt; {
            console.log(Date.now())
        }, 1000)

        // 返回一个函数
        // 模拟 WillUnMount
        return () =&gt; {
            window.clearInterval(timerId)
        }
    }, [])

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="高级特性"><a href="#高级特性" class="header-anchor">#</a> 高级特性</h2> <h3 id="react-函数组件和-class-组件有什么区别"><a href="#react-函数组件和-class-组件有什么区别" class="header-anchor">#</a> React 函数组件和 class 组件有什么区别</h3> <ul><li>函数组件是纯函数，输入 props 输出 return JSX，就是这么简单</li> <li>函数组件没有实例，没有生命周期，没有 state</li> <li>函数组件编写简洁，没有这么多个 this....</li> <li>不能扩展其他方法</li></ul> <p>选择原则</p> <ul><li>如果只输入 props 输出 JSX，那么推荐选择函数组件</li> <li>如果有其他逻辑 比如要设置 state，对生命周期做一些处理，可以选择 class 组件。
<ul><li>也可以使用 useHooks + 函数组件</li></ul></li></ul> <h3 id="有哪些-usehooks"><a href="#有哪些-usehooks" class="header-anchor">#</a> <a href="https://gabriel-yan-book.github.io/react-books/React%20Hooks.html" target="_blank" rel="noopener noreferrer">有哪些 useHooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <ul><li>useRef 与 createRef 区别</li></ul> <h3 id="什么是-react-非受控组件"><a href="#什么是-react-非受控组件" class="header-anchor">#</a> 什么是 React 非受控组件</h3> <ul><li>ref</li> <li>defaultValue 和 defaultChecked</li> <li>手动操作 DOM 元素</li></ul> <p>受控组件与非受控组件</p> <p>input 来举例子</p> <ul><li>受控组件：通过<code>state</code>自己控制值</li> <li>非受控组件：通过<code>ref</code>获取最后的值，输入的过程不受代码控制
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1dc0013c4aa4b0e950c6460893af16c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></li></ul> <p>非受控组件应用场景</p> <ul><li>必须手动操作 DOM 元素，setState 实现不了
<ul><li>eg: 文件上传<input type="file"></li> <li>某些富文本编辑器，需要传入 DOM 元素</li></ul></li></ul> <p>相关实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">App</span> expends React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

		thus<span class="token punctuation">.</span>fileInputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileInputRef<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>alertFile<span class="token punctuation">}</span><span class="token operator">&gt;</span>alert file<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token punctuation">}</span>
	 <span class="token function-variable function">alertFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> elem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileInputRef<span class="token punctuation">.</span>current <span class="token comment">// 通过 ref 获取 DOM 节点</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>受控组件 vs 非受控组件</p> <ul><li>优先使用受控组件 符合 React 设计原则，通过 state 来控制渲染。数据驱动视图</li> <li>必须手动操作 DOM 的，选择非受控组件</li></ul> <h3 id="什么场景需要使用-react-portals"><a href="#什么场景需要使用-react-portals" class="header-anchor">#</a> 什么场景需要使用 React Portals</h3> <blockquote><p>Portals 提供将子节点渲染到父节点以外的方案</p></blockquote> <p>portals 官网翻译: 插槽 有道翻译：n. 门户网站；[建]入口</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">createPortals</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>场景</p> <ul><li>overflow: hidden
<ul><li>形成 BFC ,影响子组件渲染，需要逃离父组件</li></ul></li> <li>父组件 z-index 值太小（被遮挡无法显示）</li> <li>fixed 需要放在 body 的第一层级</li></ul> <p>具体场景</p> <ul><li>对话框</li> <li>提示框</li> <li>悬浮卡</li></ul> <h3 id="对比-vue-slot-的具名插槽-和-react-this-props-children"><a href="#对比-vue-slot-的具名插槽-和-react-this-props-children" class="header-anchor">#</a> 对比 &quot;Vue slot 的具名插槽&quot; 和 &quot;react {this.props.children}&quot;</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// vue</span>
<span class="token operator">&lt;</span>navigation<span class="token operator">-</span>link url<span class="token operator">=</span><span class="token string">&quot;/profile&quot;</span><span class="token operator">&gt;</span>
  Your Profile
<span class="token operator">&lt;</span><span class="token operator">/</span>navigation<span class="token operator">-</span>link<span class="token operator">&gt;</span>

<span class="token comment">// 在 &lt;navigation-link&gt; 的模板中写为：</span>
<span class="token operator">&lt;</span>a
  v<span class="token operator">-</span>bind<span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">&quot;url&quot;</span>
  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;nav-link&quot;</span>
<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token comment">// 当组件渲染的时候，&lt;slot&gt;&lt;/slot&gt; 将会被替换为“Your Profile”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// react</span>
<span class="token comment">// 父组件</span>
<span class="token operator">&lt;</span>demoComponent<span class="token operator">&gt;</span> Your Profile <span class="token operator">&lt;</span><span class="token operator">/</span>demoComponent<span class="token operator">&gt;</span>

<span class="token comment">// 在子组件中 demoComponent 写为：</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 组件渲染 {this.props.children} 将会被替换为“Your Profile”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="react-context"><a href="#react-context" class="header-anchor">#</a> React Context</h3> <ul><li>公共信息（语言、主题）如何传递给每一个组件
<ul><li>避免通过中间元素传递 props , 用 props 太繁琐（比如组件层级太深，需要一层一层传递，麻烦，难以维护）</li> <li>redux 大材小用</li></ul></li></ul> <p>API</p> <ul><li>React.createContext</li> <li>Context.Provider</li> <li>消费者 <a href="https://zh-hans.reactjs.org/docs/context.html#contextconsumer" target="_blank" rel="noopener noreferrer">Context.Consumer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>实现</p> <p>目的：底层组件，读取上层数据</p> <ol><li>创建 context</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>组件间嵌套
<ol><li>APP</li> <li>Toolbar</li> <li>ThemeLink、ThemeButton</li></ol></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 底层组件 - 函数是组件</span>
<span class="token keyword">function</span> <span class="token function">ThemeLink</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// const theme = this.context // 会报错。函数式组件没有实例，即没有 this</span>

    <span class="token comment">// 函数式组件可以使用 Consumer</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>link's theme is <span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 底层组件 - class 组件</span>
<span class="token keyword">class</span> <span class="token class-name">ThemedButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定 contextType 读取当前的 theme context。</span>
    <span class="token comment">// static contextType = ThemeContext // 也可以用 ThemedButton.contextType = ThemeContext</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token comment">// React 会往上找到最近的 theme Provider，然后使用它的值。</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>button's theme is <span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ThemedButton<span class="token punctuation">.</span>contextType <span class="token operator">=</span> ThemeContext <span class="token comment">// 指定 contextType 读取当前的 theme context。</span>

<span class="token keyword">function</span> <span class="token function">Toolbar</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ThemedButton <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ThemeLink <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            theme<span class="token operator">:</span> <span class="token string">'light'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Toolbar <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>hr<span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeTheme<span class="token punctuation">}</span><span class="token operator">&gt;</span>change theme<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>provider<span class="token operator">&gt;</span>
	<span class="token punctuation">}</span>

	<span class="token function">changeTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            theme<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>思想</p> <ul><li>顶层组件 生产提供数据 管理数据</li> <li>底层组件 消费数据</li></ul> <h3 id="如何异步加载组件"><a href="#如何异步加载组件" class="header-anchor">#</a> 如何异步加载组件</h3> <ul><li>import() (类似 Vue)</li> <li>React.lazy</li> <li>React.Suspense</li></ul> <p>组件比较大时，或者路由懒加载时使用异步组件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TestLazyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./TestLazyComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> expents React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>TestLazyComponent<span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>测试技巧</p> <ul><li>强制刷新，可以看到 loading （可通过限制模拟慢网速 chrome 来看到）</li> <li>看 network 的 js 加载，懒加载会独立一个 js 文件懒加载</li></ul> <h3 id="react性能优化"><a href="#react性能优化" class="header-anchor">#</a> React性能优化</h3> <ul><li>重点</li> <li>性能优化对 React 更加重要</li> <li>遇到性能问题才需要优化，结合业务和实际需求</li></ul> <h4 id="scu-shouldcomponentupdate-核心问题在哪里"><a href="#scu-shouldcomponentupdate-核心问题在哪里" class="header-anchor">#</a> SCU （shouldComponentUpdate）核心问题在哪里</h4> <p>问题</p> <ul><li>父组件 state 变化的时候，SCU 默认返回 true， 子组件都默认会渲染，即 React 默认重新渲染所有子组件，无论子组件中的 state 是否变化</li></ul> <p>核心</p> <ul><li>SCU 默认返回 true，但是可以定制化，通过判断是否修改 state 或 props 来判断是否需要重新渲染</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>nextState<span class="token punctuation">.</span>num <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// 值不同 渲染</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// 不重复渲染</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="scu-一定要配合不可变值"><a href="#scu-一定要配合不可变值" class="header-anchor">#</a> SCU 一定要配合不可变值</h4> <p>如果直接修改 state 的值，在 SCU 中判断是否变化的时候，有可能会判断为没有变化，导致没有渲染</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 错误示范❌</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		num<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>num
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="purecomponent-和-memo"><a href="#purecomponent-和-memo" class="header-anchor">#</a> PureComponent 和 memo</h4> <ul><li>PureComponent SCU 中实现了浅比较
<ul><li>SCU 将跳过所有子组件树的 prop 更新。因此，请确保所有子组件也都是“纯”的组件。</li> <li>用法</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>memo: 函数组件中的 PureComponent
<ul><li>包装组件</li> <li>用法</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/* 使用 props 渲染 */</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">areEqual</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/*
	如果把 nextProps 传入 render 方法的返回结果与
	将 prevProps 传入 render 方法的返回结果一致则返回 true，
	否则返回 false
	*/</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> areEqual<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li>浅比较已适用大部分应用场景（尽量不要使用深度比较）
<ul><li>设计 state 时候，尽量不要设计过深结构</li></ul></li></ul> <h4 id="了解-immutable-js"><a href="#了解-immutable-js" class="header-anchor">#</a> 了解 <a href="https://immutable-js.com/" target="_blank" rel="noopener noreferrer">immutable.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <ul><li>一个 js module: Immutable data cannot be changed once created</li></ul> <blockquote><p>Immutable.js provides many Persistent Immutable data structures including: <code>List, Stack, Map, OrderedMap, Set, OrderedSet and Record</code>.</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Map <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'immutable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> map1 <span class="token operator">=</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> map2 <span class="token operator">=</span> map1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' vs. '</span> <span class="token operator">+</span> map2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 vs. 50</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="react-高阶组件-hoc"><a href="#react-高阶组件-hoc" class="header-anchor">#</a> React 高阶组件(HOC)</h3> <p><strong>组件公共逻辑抽离</strong></p> <ul><li>mixin 已被 React 废弃</li> <li>高阶组件 HOC (High Order Component)</li> <li>Render Props</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">HOCFactory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">HOC</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token comment">// 返回拼接的结果</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token constant">HOC</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> EnhancedComponent1 <span class="token operator">=</span> <span class="token function">HOCFactory</span><span class="token punctuation">(</span>WrappedComponent1<span class="token punctuation">)</span>
<span class="token keyword">const</span> EnhancedComponent2 <span class="token operator">=</span> <span class="token function">HOCFactory</span><span class="token punctuation">(</span>WrappedComponent2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>eg: 为组件封装获取页面的坐标逻辑</p> <p>案例</p> <ul><li>redux connect函数 是高阶组件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> VisibleTodoList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> VisibleTodoList
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://imweb.io/topic/5a1969b2a192c3b460fce226" target="_blank" rel="noopener noreferrer">connect 源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 返回一个包着渲染组件的高阶组件</p> <ul><li>将组件（WrappedComponent）传入</li> <li>将 <code>stateProps</code> <code>dispatchProps</code> <code>this.props</code> 传入到组件中，这样组件就可以用到 redux 中的数据</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Connect</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
      store<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>object
    <span class="token punctuation">}</span>
    
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
        allProps<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentWillMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">_updateProps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context
      <span class="token keyword">let</span> stateProps <span class="token operator">=</span> mapStateToProps
        <span class="token operator">?</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 防止 mapStateToProps 没有传入</span>
      <span class="token keyword">let</span> dispatchProps <span class="token operator">=</span> mapDispatchToProps
        <span class="token operator">?</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 防止 mapDispatchToProps 没有传入</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        allProps<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>stateProps<span class="token punctuation">,</span>
          <span class="token operator">...</span>dispatchProps<span class="token punctuation">,</span>
          <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>allProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Connect
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>源码基础</p> <p>1、从<code>context</code>里获取<code>store</code></p> <p>2、在<code>componentWillMount</code> 里通过<code>mapStateToProps</code>获取<code>stateProp</code>的值</p> <p>3、 在<code>componentWillMount</code> 里通过<code>mapDispatchToProps</code>获取<code>dispatchProps</code>的值</p> <p>4、在<code>componentWillMount</code>里订阅<code>store</code>的变化</p> <p>5、将获得的<code>stateProp</code>，<code>dispatchProps</code>，还有自身的<code>props</code>合成一个<code>props</code>传给下面的组件</p> <h3 id="什么是react-render-props"><a href="#什么是react-render-props" class="header-anchor">#</a> 什么是React Render Props</h3> <p>跟 HOC 类似，</p> <ul><li>核心思想：将 class 组件中的 state 作为 props 通过<strong>函数方式</strong>传递给<strong>纯函数组件</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">/* state 即多个组件的公共逻辑的数据 */</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">&lt;</span>Factory 
    <span class="token comment">// render 是一个函数组件</span>
    render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>a<span class="token punctuation">}</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>b<span class="token punctuation">}</span> <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>实例：
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46b14b3fce104ddf851bb94caae07695~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p> <h3 id="对比-hoc-和-render-props"><a href="#对比-hoc-和-render-props" class="header-anchor">#</a> 对比 HOC 和 Render Props</h3> <ul><li>HOC: 模式简单，但会增加组件层级，容易出现 props 漏传的情况</li> <li>Render Props: 代码简洁</li></ul> <h2 id="redux"><a href="#redux" class="header-anchor">#</a> Redux</h2> <h3 id="基本知识点"><a href="#基本知识点" class="header-anchor">#</a> 基本知识点</h3> <ul><li>与 Vuex 作用相同 比 Vuex 学习成本高</li> <li>不可变值，纯函数</li> <li>单向数据流</li> <li>react-redux</li> <li>异步 action</li> <li>中间件</li></ul> <h3 id="redux-单向數據流"><a href="#redux-单向數據流" class="header-anchor">#</a> Redux 单向數據流</h3> <p>概念</p> <ul><li>Action</li> <li>View</li> <li>Reducer</li> <li>Store
<blockquote><p>全局唯一的 Store 对象。大体可以认为是 MVC (Model、View、Control) 中的 Model。</p></blockquote></li></ul> <p>流程</p> <ul><li>dispatch action</li> <li>reducer -&gt; newState 不可变值</li> <li>subscribe 触发通知，触发视图层刷新</li></ul> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b8109914f58343c6b98b929657e2f167~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9663af279dff4884bfeb2e1563f10c87~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/667a4e05d3504d04b03deeb8c63d2ad9~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <h3 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> react-redux</h3> <ul><li>Provider</li> <li>connect</li> <li>mapStateToProps</li> <li>mapDispatchToProps</li></ul> <h3 id="react-action-如何处理异步"><a href="#react-action-如何处理异步" class="header-anchor">#</a> React action 如何处理异步</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 同步 action</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 返回 action</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		type<span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
		payload<span class="token operator">:</span> text
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 异步 action</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addTodoAsync</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 返回函数，其中有 dispatch 函数</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// 异步执行 action</span>
			<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong><a href="https://juejin.cn/post/6943094258307956766" target="_blank" rel="noopener noreferrer">Redux-Thunk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <ul><li>一个中间件，提供<code>Redux</code>异步解决方案</li></ul> <p>to enable Redux Thunk, use applyMiddleware():</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token keyword">import</span> rootReducer <span class="token keyword">from</span> <span class="token string">'./reducers/index'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>同类的有</p> <ul><li>redux-promise</li> <li>redux-saga</li></ul> <h3 id="简述-redux-中间件原理"><a href="#简述-redux-中间件原理" class="header-anchor">#</a> 简述 Redux 中间件原理</h3> <p>在 redux 的流程中，改造 dispatch 实现中间件的逻辑</p> <p>实现代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 中间件使用</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
	reducer<span class="token punctuation">,</span>
	<span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token comment">// 会按顺序执行</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// logger 代码实现</span>
<span class="token keyword">let</span> next <span class="token operator">=</span> store<span class="token punctuation">.</span>dispach<span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">dispatchAndLog</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before action: '</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
	<span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'after action: '</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="react-router-知识点"><a href="#react-router-知识点" class="header-anchor">#</a> react-router 知识点</h3> <ul><li>hash模式（默认），eg: http://abc.com/#/user/001</li> <li>H5 history模式，eg: http://abc.com/user/001
<ul><li>需要server支持，因此无特殊需求选择hash模式</li></ul></li></ul> <p>代码实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment">// hash</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HashRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span> Route<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span> 

<span class="token comment">// H5</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span> Route<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span> 


<span class="token keyword">function</span> <span class="token function">RouterComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Router exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>Home<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Router path<span class="token operator">=</span><span class="token string">&quot;/project/:id&quot;</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>Project <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Router path<span class="token operator">=</span><span class="token string">&quot;*&quot;</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>NotFound <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React form <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Link<span class="token punctuation">,</span> useParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword">function</span> <span class="token function">Project</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>React-router 路由跳转</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

<span class="token keyword">function</span> <span class="token function">Trash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> history <span class="token operator">=</span> <span class="token function">useHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>回到首页<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>React-router 路由配置 懒加载</p> <ul><li>Suspense</li> <li>lazy import</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Suspense<span class="token punctuation">,</span> lazy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Suspense<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Router exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>react router 原理</p> <p>参考资料</p> <ul><li><a href="https://juejin.cn/post/6886290490640039943" target="_blank" rel="noopener noreferrer">「源码解析 」这一次彻底弄懂react-router路由原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h1 id="react-原理"><a href="#react-原理" class="header-anchor">#</a> React 原理</h1> <h2 id="函数式编程-不可变值"><a href="#函数式编程-不可变值" class="header-anchor">#</a> 函数式编程 不可变值</h2> <h2 id="vdom-和-diff"><a href="#vdom-和-diff" class="header-anchor">#</a> vdom 和 diff</h2> <h2 id="jsx的本质"><a href="#jsx的本质" class="header-anchor">#</a> JSX的本质</h2> <p>JSX是一种类XML语言，是JavaScript的语法扩展，全称是JavaScript XML。</p> <ul><li>JSX 相當於 Vue 模板</li> <li>Vue 模板不是 html</li> <li>JSX 不是 JS</li></ul> <p>核心</p> <ul><li>React.createElement 即 h 函数，返回 vnode</li> <li>第一个参数，可能是组件、html、tag</li> <li>组件名，首字母必须大写（React 规定）</li></ul> <p>可以通过 <a href="https://www.babeljs.cn/repl" target="_blank" rel="noopener noreferrer">babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 编译 JSX，看编译出来的本质</p> <p>eg:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ImgElem <span class="token operator">=</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;div1&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>some text<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>imgUrl<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>ImgElem<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 结果</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ImgElem <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&quot;div1&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">/*#__PURE__*/</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;some text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">/*#__PURE__*/</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> imgUrl
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">/*#__PURE__*/</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>ImgElem<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><a href="https://reactjs.org/docs/react-api.html#createelement" target="_blank" rel="noopener noreferrer">总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
  type<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>props<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token operator">...</span>children<span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>Create and return a new React element of the given type.</p></blockquote> <ul><li><p>React.createElement('div', null, [child1, child2, child3])</p></li> <li><p>React.createElement('div', {...}, child1, child2, child3)</p></li> <li><p>React.createElement(List, null, child1, child2, '文本节点')</p></li> <li><p>h 函數</p></li> <li><p>返回 vnode(virtual node 虚拟节点)的数据结构</p></li> <li><p>patch 函數</p></li></ul> <h2 id="合成事件机制"><a href="#合成事件机制" class="header-anchor">#</a> 合成事件机制</h2> <h2 id="setstate-主流程-batchupdate机制"><a href="#setstate-主流程-batchupdate机制" class="header-anchor">#</a> setState 主流程 batchUpdate机制</h2> <h2 id="transaction-事务-机制"><a href="#transaction-事务-机制" class="header-anchor">#</a> transaction(事务)机制</h2> <h2 id="组件渲染和更新过程"><a href="#组件渲染和更新过程" class="header-anchor">#</a> 组件渲染和更新过程</h2> <h2 id="react-fiber"><a href="#react-fiber" class="header-anchor">#</a> React fiber</h2> <ul><li>是React16.13 新增的一个性能优化的方案</li> <li>React 内部运行机制，开发者体会不到</li></ul> <p>背景</p> <p>更新性能问题</p> <ul><li>JS 单线程，与 DOM 渲染共用同一线程；</li> <li>当组件复杂，更新时计算和渲染压力大；</li> <li>此时再有频繁的 DOM 操作需求（动画，鼠标拖拽），将掉帧卡顿
<ul><li><a href="https://claudiopro.github.io/react-fiber-vs-stack-demo/fiber.html" target="_blank" rel="noopener noreferrer">Fiber Example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="https://segmentfault.com/img/bVboIan?w=550&amp;h=280" alt="Fiber Example"></li> <li><a href="https://claudiopro.github.io/react-fiber-vs-stack-demo/stack.html" target="_blank" rel="noopener noreferrer">Stack Example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="https://segmentfault.com/img/bVboH8j?w=550&amp;h=280" alt="stack Example"></li></ul></li></ul> <p>为了解决上述性能问题，更新阶段 <code>patch</code> 分为两个阶段</p> <ol><li><a href="https://dict.youdao.com/search?q=reconciliation&amp;keyfrom=new-fanyi.smartResult" target="_blank" rel="noopener noreferrer">reconciliation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>阶段：
执行 diff 算法，纯 JS 计算</li> <li>commit 阶段：将 diff 结果渲染到 DOM 上</li></ol> <p>解决方案fiber，<code>任务分片</code> <code>时间分片</code>思想</p> <ul><li>将 reconciliation 阶段进行任务拆分 （因为 commit 阶段无法拆分）</li> <li>DOM 需要渲染时暂停，空闲时恢复</li> <li>通过 window.requestIdleCallback(idle: 闲置) 可以知道 DOM 什么时候需要渲染
<ul><li>window.requestIdleCallback()方法插入一个函数，这个函数将在浏览器空闲时期被调用</li> <li>如果浏览器不支持该API，fiber 不生效，也无妨</li></ul></li></ul> <p>数据结构</p> <ul><li>由于原有的堆栈结构，暂停重启任务来实现分片，递归无法中断
<ul><li>实现分片需要<code>随时停止遍历并稍后恢复</code></li></ul></li> <li>所以由<code>栈</code>修改为<code>单链表</code>的形式，虚拟堆栈，在遍历树的时候不会增长堆栈</li></ul> <h3 id="react-fiber如何优化性能"><a href="#react-fiber如何优化性能" class="header-anchor">#</a> React-fiber如何优化性能</h3> <h2 id="react-和-vue-的区别、-react-和-vue-如何技术选型。分别更适合和擅长哪些业务"><a href="#react-和-vue-的区别、-react-和-vue-如何技术选型。分别更适合和擅长哪些业务" class="header-anchor">#</a> React 和 Vue 的区别、 React 和 Vue 如何技术选型。分别更适合和擅长哪些业务？</h2> <p><strong>React 和 Vue 的区别</strong></p> <ul><li>相同点
<ul><li>都支持组件化</li> <li>都是数据驱动视图</li> <li>都是 vdom 操作 DOM</li></ul></li> <li>不同点
<ul><li>React 用 JSX(JS)，Vue 使用模板(html)
<blockquote><p>JSX + inline style，也就是把 HTML 和 CSS 全都整进 JavaScript 了</p></blockquote></li> <li>React 函数式编程，Vue 声明式编程</li> <li>React 更多的是自力更生，Vue 把想要的都给你
<ul><li>例如：<a href="https://www.jianshu.com/p/6e124ad23c68" target="_blank" rel="noopener noreferrer">vue 双向绑定和 react 数据绑定 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <blockquote><p>双向绑定是对表单来说的，表单的双向绑定，说到底不过是 value 的单向绑定 + onChange 事件侦听的一个语法糖。</p></blockquote></li> <li>Vue 的默认 <code>API</code> 是以简单易上手为目标</li></ul></li></ul> <blockquote><p>React 的社区/组件生态比 Vue 大很多</p></blockquote></li></ul> <p><strong>React 和 Vue 如何技术选型。分别更适合和擅长哪些业务？</strong></p> <ol><li>应用场景，业务考虑。有人认为，vue 不适合大型项目</li></ol> <blockquote><p>在超大量数据的首屏渲染速度上，React 有一定优势，因为 Vue 的渲染机制启动时候要做的工作比较多，而且 React 支持服务端渲染。</p></blockquote> <blockquote><p>大列表渲染，大量数据加载，不做进一步优化的话Vue明显比React慢</p></blockquote> <ol start="2"><li><p>从技术开发团队熟悉程度和招人成本考虑。熟悉哪个框架，哪个框架的人容易招。</p></li> <li><p>从社区大小和活跃度考虑。</p></li></ol> <p>参考：</p> <ul><li><a href="https://www.zhihu.com/question/31585377" target="_blank" rel="noopener noreferrer">Vue和React的使用场景和深度有何不同？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="自定义-hooks"><a href="#自定义-hooks" class="header-anchor">#</a> 自定义 hooks</h2> <p>通过 antd 中的 Grid 判断是否是 desktop 版</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 定义</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Grid <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> useBreakpoint <span class="token punctuation">}</span> <span class="token operator">=</span> Grid<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useIsDesktop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>isDesktop<span class="token punctuation">,</span> setIsDesktop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> screens <span class="token operator">=</span> <span class="token function">useBreakpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useBreakpoint screens :&gt;&gt; '</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>screens<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> isDesktop <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>screens<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">screen</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>screen<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>screen<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">screen</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>screen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'md'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 如果存在 md 尺寸, 證明是桌面版</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'isDesktop :&gt;&gt; '</span><span class="token punctuation">,</span> isDesktop<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">setIsDesktop</span><span class="token punctuation">(</span>isDesktop<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

	<span class="token keyword">return</span> isDesktop<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useIsDesktop <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/common/customHooks/useIsDesktop'</span>

<span class="token keyword">const</span> isDesktop <span class="token operator">=</span> <span class="token function">useIsDesktop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/28/2023, 9:53:21 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#基础" class="sidebar-link reco-side-基础" data-v-70334359>基础</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#jsx基础知识点" class="sidebar-link reco-side-jsx基础知识点" data-v-70334359>JSX基础知识点</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#jsx如何判断条件和渲染列表" class="sidebar-link reco-side-jsx如何判断条件和渲染列表" data-v-70334359>JSX如何判断条件和渲染列表</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react事件为何bind-this" class="sidebar-link reco-side-react事件为何bind-this" data-v-70334359>React事件为何bind this</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-event-事件和-dom-事件的区别" class="sidebar-link reco-side-react-event-事件和-dom-事件的区别" data-v-70334359>React event 事件和 DOM 事件的区别</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-表单知识点" class="sidebar-link reco-side-react-表单知识点" data-v-70334359>React 表单知识点</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react父子组件通讯" class="sidebar-link reco-side-react父子组件通讯" data-v-70334359>React父子组件通讯</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#setstate-为何使用不可变值" class="sidebar-link reco-side-setstate-为何使用不可变值" data-v-70334359>setState 为何使用不可变值</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#setstate-是同步的还是异步的" class="sidebar-link reco-side-setstate-是同步的还是异步的" data-v-70334359>setState 是同步的还是异步的</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#setstate何时会合并state" class="sidebar-link reco-side-setstate何时会合并state" data-v-70334359>setState何时会合并state</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-component-组件生命周期" class="sidebar-link reco-side-react-component-组件生命周期" data-v-70334359>React Component 组件生命周期</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#高级特性" class="sidebar-link reco-side-高级特性" data-v-70334359>高级特性</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-函数组件和-class-组件有什么区别" class="sidebar-link reco-side-react-函数组件和-class-组件有什么区别" data-v-70334359>React 函数组件和 class 组件有什么区别</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#有哪些-usehooks" class="sidebar-link reco-side-有哪些-usehooks" data-v-70334359>有哪些 useHooks</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#什么是-react-非受控组件" class="sidebar-link reco-side-什么是-react-非受控组件" data-v-70334359>什么是 React 非受控组件</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#什么场景需要使用-react-portals" class="sidebar-link reco-side-什么场景需要使用-react-portals" data-v-70334359>什么场景需要使用 React Portals</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#对比-vue-slot-的具名插槽-和-react-this-props-children" class="sidebar-link reco-side-对比-vue-slot-的具名插槽-和-react-this-props-children" data-v-70334359>对比 &quot;Vue slot 的具名插槽&quot; 和 &quot;react {this.props.children}&quot;</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-context" class="sidebar-link reco-side-react-context" data-v-70334359>React Context</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#如何异步加载组件" class="sidebar-link reco-side-如何异步加载组件" data-v-70334359>如何异步加载组件</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react性能优化" class="sidebar-link reco-side-react性能优化" data-v-70334359>React性能优化</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-高阶组件-hoc" class="sidebar-link reco-side-react-高阶组件-hoc" data-v-70334359>React 高阶组件(HOC)</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#什么是react-render-props" class="sidebar-link reco-side-什么是react-render-props" data-v-70334359>什么是React Render Props</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#对比-hoc-和-render-props" class="sidebar-link reco-side-对比-hoc-和-render-props" data-v-70334359>对比 HOC 和 Render Props</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#redux" class="sidebar-link reco-side-redux" data-v-70334359>Redux</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#基本知识点" class="sidebar-link reco-side-基本知识点" data-v-70334359>基本知识点</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#redux-单向數據流" class="sidebar-link reco-side-redux-单向數據流" data-v-70334359>Redux 单向數據流</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-redux" class="sidebar-link reco-side-react-redux" data-v-70334359>react-redux</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-action-如何处理异步" class="sidebar-link reco-side-react-action-如何处理异步" data-v-70334359>React action 如何处理异步</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#简述-redux-中间件原理" class="sidebar-link reco-side-简述-redux-中间件原理" data-v-70334359>简述 Redux 中间件原理</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-router-知识点" class="sidebar-link reco-side-react-router-知识点" data-v-70334359>react-router 知识点</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#函数式编程-不可变值" class="sidebar-link reco-side-函数式编程-不可变值" data-v-70334359>函数式编程 不可变值</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#vdom-和-diff" class="sidebar-link reco-side-vdom-和-diff" data-v-70334359>vdom 和 diff</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#jsx的本质" class="sidebar-link reco-side-jsx的本质" data-v-70334359>JSX的本质</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#合成事件机制" class="sidebar-link reco-side-合成事件机制" data-v-70334359>合成事件机制</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#setstate-主流程-batchupdate机制" class="sidebar-link reco-side-setstate-主流程-batchupdate机制" data-v-70334359>setState 主流程 batchUpdate机制</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#transaction-事务-机制" class="sidebar-link reco-side-transaction-事务-机制" data-v-70334359>transaction(事务)机制</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#组件渲染和更新过程" class="sidebar-link reco-side-组件渲染和更新过程" data-v-70334359>组件渲染和更新过程</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#react-fiber" class="sidebar-link reco-side-react-fiber" data-v-70334359>React fiber</a></li><li class="level-3" data-v-70334359><a href="/blogs/FE/React_Base.html#react-fiber如何优化性能" class="sidebar-link reco-side-react-fiber如何优化性能" data-v-70334359>React-fiber如何优化性能</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#react-和-vue-的区别、-react-和-vue-如何技术选型。分别更适合和擅长哪些业务" class="sidebar-link reco-side-react-和-vue-的区别、-react-和-vue-如何技术选型。分别更适合和擅长哪些业务" data-v-70334359>React 和 Vue 的区别、 React 和 Vue 如何技术选型。分别更适合和擅长哪些业务？</a></li><li class="level-2" data-v-70334359><a href="/blogs/FE/React_Base.html#自定义-hooks" class="sidebar-link reco-side-自定义-hooks" data-v-70334359>自定义 hooks</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.a6f77771.js" defer></script><script src="/assets/js/3.7f2c89d8.js" defer></script><script src="/assets/js/1.7045c4ac.js" defer></script><script src="/assets/js/28.66456a8e.js" defer></script>
  </body>
</html>
