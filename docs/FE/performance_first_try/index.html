<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-FE/performance_first_try">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Web 性能优化 | Aki Huang 🤔👊💪✍️👀👨‍💻‍</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huangzonggui.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://huangzonggui.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://huangzonggui.github.io/docs/FE/performance_first_try"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Web 性能优化 | Aki Huang 🤔👊💪✍️👀👨‍💻‍"><meta data-rh="true" name="description" content="准备"><meta data-rh="true" property="og:description" content="准备"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huangzonggui.github.io/docs/FE/performance_first_try"><link data-rh="true" rel="alternate" href="https://huangzonggui.github.io/docs/FE/performance_first_try" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huangzonggui.github.io/docs/FE/performance_first_try" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a080d72f.css">
<link rel="preload" href="/assets/js/runtime~main.9bbf9b1a.js" as="script">
<link rel="preload" href="/assets/js/main.ba5ceb0e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">A.H</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/FE/base/Navigation_URL">文章</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/huangzonggui/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/FE/base/Navigation_URL">前端</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/FE/base/Navigation_URL">基础</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/Auth">关于鉴权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/CSS_Layout">圣杯布局与双飞翼布局</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/HTML_CSS">HTML CSS 基础知识总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/HTTP">HTTP 超文本传输协议相关知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/JS_Base">JavaScript 基础知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/PNPM_Yarn_npm">pnpm yarn npm 包管理工具区别</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/React_Base">React基础知识和原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/React_Native">React_Native</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/Seven_Day">前端八股文</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/Study">学习推荐资料</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/Vue_20211130">Vue实现与原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/interview">前端题目思考总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/npm_module_privatization">在第三方模块中修改使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/FE/performance_first_try">Web 性能优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/web_security">浏览器安全</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/webpackAndBabel">webpack 和 Babel 常用的基本配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/wechatMiniProgram">wechatMiniProgram</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/FE/yifangda">复盘</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/finance/">index</a><button aria-label="打开/收起侧边栏菜单「index」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/DataStructuresAndAlgorithms/120401">算法</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Think/images">思考🤔</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">前端</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Web 性能优化</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>性能检测</h1><p>准备</p><ul><li>Chrome Canary 版的浏览器，Chrome Canary 是采用最新技术构建的，它的开发者工具和浏览器特性都是最新的，推荐使用 Chrome Canary 来做性能分析。</li><li>隐身模式 （防止插件、cookie、缓存干扰）</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lighthouse">Lighthouse<a href="#lighthouse" class="hash-link" aria-label="Lighthouse的直接链接" title="Lighthouse的直接链接">​</a></h2><p> chrome v83.0.4103.61 的 Audits 升级成 Lighthouse 了</p><p> 检测内容</p><ul><li>监测并分析 Web 性能 (Performance)；</li><li>监测并分析 PWA(Progressive Web App) 程序的性能；</li><li>监测并分析 Web 应用是否采用了最佳实践策略 (Best practices)；</li><li>监测并分析是否实施了无障碍功能 (Accessibility)，无障碍功能让一些身体有障碍的人可以方便地浏览你的 Web 应用。监测并分析 Web 应用是否采实施了 SEO 搜素引擎优化 (SEO)。</li></ul><p>测试报告例子
<img loading="lazy" src="/assets/images/2021-12-11-10-08-49-01d7a88701ffb8188ca27e03314e6797.png" width="1776" height="1994" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/2021-12-11-10-01-06-1ac2c251a1dde38beed63b5d69054ea9.png" width="1688" height="1886" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/2021-12-11-10-01-35-31a5bff162823155e88626ae505b5188.png" width="3580" height="1888" class="img_ev3q"></p><p>各个指标含义</p><ul><li><p>首次内容绘制(First Contentful Paint)
<a href="https://web.dev/i18n/zh/fcp/" target="_blank" rel="noopener noreferrer">图片来源</a>
<img loading="lazy" src="/assets/images/2022-02-20-10-15-09-e3d52f987cb655cd0a41b2fc1cfe102c.png" width="1548" height="990" class="img_ev3q">
<img loading="lazy" src="/assets/images/2022-02-20-10-13-01-74df2dccd605a71b7560d49118b8d440.png" width="2444" height="1202" class="img_ev3q"></p></li><li><p>完全可交互时间 (Time to Interactive)；</p></li><li><p>速度指标（Speed Index）。衡量了首屏可见内容绘制在屏幕上的速度。
在首次加载页面的过程中尽量展现更多的内容，往往能给用户带来更好的体验，所以速度指标的值约小越好。</p></li><li><p>阻塞总时间（Total Blocking Time）：测量的是 <code>FCP</code> 与 <code>TTI</code> 之间的<code>时间间隔</code>。这个指标反映了用户的交互<strong>是否能及时响应</strong>。 如果主线程执行了长任务会导致用户的输入无法及时响应。
当主线执行的任务所需的时长超过 <code>50ms</code>，我们就认为这是一个长任务（<code>long task</code>）。假设在主线程上执行了一系列的任务，每个长任务的阻塞时间等于执行时间减去 50 ms，最后可以统计得到一个总的阻塞时间。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- [参考](https://zhuanlan.zhihu.com/p/376925215)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [https://web.dev/tbt/](https://web.dev/tbt/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">![](./images/2022-02-20-10-30-41.png)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>最大内容绘制(Largest Contentful Paint): 当首屏内容完全绘制完成时，我们把这个时间点称为 Largest Content Paint，简称 LCP。</p><ul><li><a href="https://web.dev/i18n/zh/lcp/#lcp-4" target="_blank" rel="noopener noreferrer">参考</a></li></ul></li></ul><h1>性能优化</h1><p>思考: 如果下载 CSS 文件阻塞了，会阻塞 DOM 树的合成吗？会阻塞页面的显示吗？</p><p><strong>不会影响 DOM 树的合成，但是会阻塞 DOM 树的渲染显示。</strong></p><p><strong>原因：</strong> DOM 解析（paser） 和 CSS 解析是并行的，CSS 下载和加载不会导致 DOM 树的合成。但是 DOM 树的 Render (渲染)需要依赖 CSS 布局，所以会阻塞 DOM 树的渲染。
<img loading="lazy" src="/assets/images/2023-01-29-23-52-28-788d89c3dc0cd08dea634d230982e504.png" width="1722" height="928" class="img_ev3q"></p><p>所以为了避免用户看到长时间的白屏，应该尽快提高 CSS 的加载速度。 </p><ol><li>使用CDN；</li><li>CSS的压缩（使用webpack、gulp等打包工具）； </li><li>合理使用缓存（设置缓存控制、表达式和e-tag）；
DOM 解析和 CSS 解析是两个<strong>并行的</strong>过程，所以这也解释了为什么CSS加载不会阻塞DOM解析。
但是因为 <code>render tree</code> <strong>依赖于</strong> <code>DOM</code> 树和 <code>cssom</code> 树，所以必须等到 cssom 树构建完成，也就是 CSS 资源加载完成。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="页面性能如何系统地优化页面">页面性能：如何系统地优化页面？<a href="#页面性能如何系统地优化页面" class="hash-link" aria-label="页面性能：如何系统地优化页面？的直接链接" title="页面性能：如何系统地优化页面？的直接链接">​</a></h2><p><strong>重排(reflow, 也叫回流)：更新了元素的几何属性</strong>
修改了宽高位置等，导致需要重新布局。
<img loading="lazy" src="/assets/images/2022-02-19-21-13-55-84de99ab2db24232a0a47d3681f860f7.png" width="1912" height="672" class="img_ev3q"></p><p>触发重排的情况：</p><ul><li>添加或删除可见 DOM 元素</li><li>改变浏览器窗口尺寸。如 resize 事件</li><li>激活伪类。如 :hover</li><li>改变元素尺寸：<code>width、height、line-height、min-height、border-width、border</code></li><li><code>font-size</code></li><li><code>margin、padding</code></li><li>改变元素位置：<code>position、overflow、left、right、bottom、top、text-align</code> </li><li><code>offsetWidth、offsetHeight</code></li></ul><p><strong>重绘：更新绘制属性。元素的外观</strong></p><p>触发重绘的情况：</p><ul><li>color</li><li>border-style</li><li>visibility</li><li>background</li><li>text-decoration</li><li>background-image</li><li>background-position</li><li>background-repeat</li><li>outline-color</li><li>outline</li><li>outline-style</li><li>border-radius</li><li>outline-width</li><li>box-shadow</li><li>background-size</li></ul><p><img loading="lazy" src="/assets/images/2022-02-19-21-18-04-414f4d32ce05f644a85bfce1be0d52e9.png" width="1896" height="684" class="img_ev3q"></p><p><strong>合成</strong></p><p>CSS 的 <code>transform</code> 来实现动画效果。
直接在非主线程上执行合成动画操作。因为是在非主线程上合成，并没有占用主线程的资源</p><p><img loading="lazy" src="/assets/images/2022-02-19-21-30-04-7f4b355310ba8d080c453e6790cb8717.png" width="1830" height="596" class="img_ev3q"></p><p>减少重排重绘：</p><ol><li>使用 class 操作样式，而不是频繁操作 style： 通过使用 class 来集中修改样式，而不是通过 style 一个一个的修改。</li><li>避免使用 table 布局:
1) 由于浏览器使用流式布局，对 Render Tree 的计算通常只需要遍历一次就可以完成，但 Table 及内部元素除外，通常需要多次计算且需花费3倍同等元素时间。
2) 其次，很小的改动可能会导致整个 table 都重新布局</li><li>批量dom 操作，例如 createDocumentFragment，或者使用框架，例如 React：批量操作 DOM 可以减少重排重绘的次数</li><li>Debounce window resize 事件： 防抖可以防止频繁触发重排重绘，例如 window resize 可以设置为 1s 内只可以触发一次</li><li>对 dom 属性的读写要分离 ：<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">// 写</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetLeft</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">// 读 会触发立即执行渲染队列的任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">top</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetTop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;20px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetWidth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;20px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetHeight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 以上代码会触发4次重排+重绘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>修改为读写分离操作，触发一次重排</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">top</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;20px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;20px&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetLeft</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetTop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetWidth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetHeight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 作者：OBKoro1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 链接：https://juejin.cn/post/6844903745914929165</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 来源：稀土掘金</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>will-change: transform 做优化： 使浏览器提前准备好过渡动画</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载阶段-白屏优化">加载阶段 白屏优化<a href="#加载阶段-白屏优化" class="hash-link" aria-label="加载阶段 白屏优化的直接链接" title="加载阶段 白屏优化的直接链接">​</a></h3><p>首屏时间标准</p><blockquote><p>如果“首屏时间”在一秒内可谓秒开，在2秒以内是比较优秀的，5秒以内用户可以接受，10秒以上就不可容忍了。</p></blockquote><p>首屏和白屏的区别</p><ul><li><p>白屏时间：用户进入网站，一直到有内容展示的时间节点</p><ul><li>DNS 查询、建立 TCP 链接、发起第一个HTTP请求、返回 HTML 文档、HTML 文档 Head 解析完毕</li><li>计算</li></ul><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">DOCTYPE</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">白屏</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">text/javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 不兼容performance.timing 的浏览器，如IE8</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">pageStartTime</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript known-class-name class-name">Date</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">now</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 页面 CSS 资源 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">link</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">stylesheet</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">common.css</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">link</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">stylesheet</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">page.css</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">text/javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 白屏时间结束点</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">firstPaint</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript known-class-name class-name">Date</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">now</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 页面内容 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 支持 Performance API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPaint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  firstPaintEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">navigationStart</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 不支持 Performance API，在 `page onload` 中计算结束时间 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        firstPaintEnd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPaint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  firstPaintEnd </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pageStartTime</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>首屏时间 = 白屏时间 + 首屏渲染时间</p></li></ul><p><a href="https://976500133.gitbooks.io/frontendbook/content/http/http-white.html" target="_blank" rel="noopener noreferrer">首屏和白屏时间计算</a></p><p>加载阶段渲染流水线
<img loading="lazy" src="/assets/images/2022-02-19-18-09-32-b9aa803e158b46c24ce97ca23f0ae253.png" width="2404" height="1034" class="img_ev3q">
<img loading="lazy" src="/assets/images/2022-02-19-18-09-58-074eecce0f8de7ffba3187e9a1858672.png" width="2012" height="1100" class="img_ev3q"></p><p>影响白屏主要瓶颈</p><ul><li>下载 CSS</li><li>下载 JavaScript</li><li>执行 JavaScript</li></ul><p>能阻塞网页首次渲染的资源（HTML、JavaScript、CSS）称为<code>关键资源</code>。核心要素</p><ul><li><p>关键资源的个数</p></li><li><p>关键资源的大小</p></li><li><p>请求关键资源需要多少个RTT(Round Trip Time)。<code>使用 CDN 来减少每次 RTT 时长</code></p><blockquote><p>当使用 TCP 协议传输一个文件时，比如这个文件大小是 0.1M，由于 TCP 的特性，
这个数据并不是一次传输到服务端的，而是需要拆分成一个个数据包来回多次进行传输的。RTT 就是这里的往返时延。
它是网络中一个重要的性能指标，表示从发送端发送数据开始，到发送端收到来自接收端的确认，总共经历的时延。
通常 1 个 HTTP 的数据包在 14KB 左右，所以 1 个 0.1M 的页面就需要拆分成 8 个包来传输了，也就是说需要 8 个 RTT。</p></blockquote><blockquote><p>由于渲染引擎有一个预解析的线程，在接收到 HTML 数据之后，预解析线程会快速扫描 HTML 数据中的关键资源，一旦扫描到了，
会立马发起请求，你可以认为 JavaScript 和 CSS 是同时发起请求的，所以它们的请求是重叠的，那么计算它们的 RTT 时，
只需要计算体积最大的那个数据就可以了</p></blockquote></li></ul><p>缩短白屏时长</p><ul><li><p>可以内联 JS 和 CSS，移除下载</p></li><li><p>减少文件大小。</p><ul><li>服务器设置开启 gzip。eg: Nginx开启Gzip压缩</li><li>通过 webpack 移除一些注释，压缩JS 和 CSS</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* @file webpack.config.js, 只保留了关键部分的配置.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">module</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">loaders</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">test</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">\.css$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 移除 CSS 内注释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">loader</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">ExtractTextPlugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">extract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;vue-style&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;css?&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;discardComments&quot;:{&quot;removeAll&quot;:true}}&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">optimize</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">UglifyJsPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 移除 JavaScript 内注释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">comments</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">minify</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 移除 HTML 内注释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">removeComments</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>抽离和压缩 CSS(mini-css-extract-plugin)</li><li>接入treeShaking，剔除无用代码</li><li>webpack 开启 Scope hosting（作用域提升）</li></ul></li><li><p>CDN 加快下载速度</p></li><li><p>将不需要解析 HTML 阶段使用的 JavaScript 标记上 async 或者 defer</p><ul><li>async（异步：下载异步，没特定指定执行在什么时候，所以是下载完就执行）: 异步下载，下载完就会执行。多个标记了 async 的 JavaScript 不分先后顺序</li><li>defer(推迟：将执行推迟到 parser 后): 异步下载，在所有<code>元素解析完成之后(HTML parser)</code>，<code>DOMContentLoaded 事件触发之前</code>执行。多个标记了 defer 的 JavaScript 有先后顺序</li><li>主要区别：下载完何时执行</li></ul><p><a href="https://segmentfault.com/q/1010000000640869" target="_blank" rel="noopener noreferrer">defer和async的区别</a>
<img loading="lazy" src="/assets/images/2022-02-19-19-05-01-24bfc0210c8f3f37175f03de7faf8833.png" width="1588" height="1648" class="img_ev3q"></p><p><a href="https://segmentfault.com/a/1190000006778717" target="_blank" rel="noopener noreferrer">此文章提到兼容性问题，提到上图不够严谨</a></p></li><li><p>script 放在 body 后面，也不会阻塞构建 DOM 树</p><ul><li>原因一：防止阻塞构建 DOM 树</li><li>原因二：<a href="https://codepen.io/huangzonggui/pen/WNXMPOe" target="_blank" rel="noopener noreferrer">可能会操作 DOM，如果操作了 DOM 还没渲染出来的部分，会出错</a></li></ul></li><li><p>大的 CSS 文件，通过媒体查询，将其拆分为多个不同用途的 CSS 文件，这样只有在特定的场景下才会加载特定的 CSS 文件。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="交互阶段">交互阶段<a href="#交互阶段" class="hash-link" aria-label="交互阶段的直接链接" title="交互阶段的直接链接">​</a></h3><p>修改了颜色、字体，不会涉及到布局调整，可以跳过布局阶段，直接进入绘制阶段，这个过程叫<code>重绘</code>。</p><p>通过 CSS 实现的渐变、动画、变形等特效，是在<code>合成线程</code>中执行的，这个过程称为<code>合成</code>。
合成不会触发重排和重绘，合成操作速度本身是很快的，所以执行合成效率是最高的。所以一般能
用 CSS 来实现的尽量使用 CSS 来代替 JavaScript。</p><p>优化原则：<strong>让单个帧生成速度标快</strong></p><ol><li><p>减少 JavaScript 脚本执行时间</p><ul><li>将一次执行的函数分解为多个任务，使得每次的执行时间不要过久<ul><li>react fiber 任务分片思想算不算？</li></ul></li><li>采用 <code>Web Workers</code>，独立于主线程外的线程。不过 Web Workers 中没有 DOM、CSSOM 环境，
可以把一些和 DOM 操作无关且耗时的任务放到 Web Workers 中去执行。<blockquote><p>总之，在交互阶段，对 JavaScript 脚本总的原则就是<code>不要一次霸占太久主线程。</code></p></blockquote></li></ul></li><li><p>避免强制同步布局</p><blockquote><p>执行 <code>JavaScript 添加元素</code>是在一个任务中执行的，<code>重新计算样式布局</code>是在<code>另外一个任务</code>中执行，这就是正常情况下的布局操作。</p></blockquote><p><strong>强制同步布局，就是强制将计算样式和布局操作提前到当前任务中执行</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> main_div </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mian_div&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> new_node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;li&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> textnode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTextNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;time.geekbang&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new_node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">textnode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mian_div&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">new_node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//由于要获取到offsetHeight，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//但是此时的offsetHeight还是老的数据，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//所以需要立即执行布局操作(强制同步布局)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">main_div</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetHeight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>避免布局抖动
<strong>在一段 JavaScript 代码中，反复执行布局操作，就是布局抖动</strong>
<img loading="lazy" src="/assets/images/2022-02-19-20-53-07-a07e494777cf27ce4780e402c3b19ef8.png" width="3464" height="2018" class="img_ev3q"></p><blockquote><p>尽量不要在修改 DOM 结构时再去查询一些相关值</p></blockquote></li><li><p>合理利用 CSS 动画</p></li></ol><ul><li><p>能让 CSS 处理动画，就尽量交给 CSS 来操作。</p></li><li><p>如果能提前知道对某个元素执行动画操作，将其标记为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/will-change" target="_blank" rel="noopener noreferrer"><code>will-change</code></a>，这是告诉渲染引擎需要将该元素<code>单独生成一个图层</code></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> scroll</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> transform        </span><span class="token comment" style="color:#999988;font-style:italic">// Example of &lt;custom-ident&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> opacity          </span><span class="token comment" style="color:#999988;font-style:italic">// Example of &lt;custom-ident&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top        </span><span class="token comment" style="color:#999988;font-style:italic">// Example of two &lt;animateable-feature&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> unset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> initial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">change</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> inherit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><ol start="5"><li>使用 HTTP 2.0，提升网络速度</li></ol><ul><li>HTTP/2 多路复用<ul><li>使用<code>二进制分帧</code></li><li>HTTP/1.1 之所以无法多路复用，是因为 HTTP/1.1是基于“文本分割”解析的协议
<img loading="lazy" src="/assets/images/2022-02-19-21-05-16-5ecb8937f72f0c770b50282029c48453.png" width="732" height="726" class="img_ev3q"></li></ul></li><li>一个域名只使用<code>一个 TCP 长连接</code>和<code>消除队头阻塞</code>问题</li><li>头部压缩</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实践">实践<a href="#实践" class="hash-link" aria-label="实践的直接链接" title="实践的直接链接">​</a></h2><ul><li><p>多语言文件</p></li><li><p>多语言样式</p><ul><li>媒体查</li><li>样式公共抽离</li><li>样式变量</li></ul></li><li><p>js css 在首次渲染的时候不必要的文件，将其设置为 defer async</p><ul><li>async 标志的脚本文件一旦加载完成，会立即执行；</li><li>defer 标记的脚本文件，需要在 <code>DOMContentLoaded</code> 事件之前执行。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vben-框架使用-vite2x-启动首屏加载慢原因剖析">vben 框架使用 vite2.x 启动，首屏加载慢原因剖析<a href="#vben-框架使用-vite2x-启动首屏加载慢原因剖析" class="hash-link" aria-label="vben 框架使用 vite2.x 启动，首屏加载慢原因剖析的直接链接" title="vben 框架使用 vite2.x 启动，首屏加载慢原因剖析的直接链接">​</a></h3></li><li><p>旧版 vben 中使用的 vite2.x 时，首次启动，<code>main.ts Wating for server response</code> 使用了 6-8 秒，编译 <code>antd/.../index.less</code> 也非常耗时，启动后 loading 的时间过长
<img loading="lazy" src="/assets/images/2023-06-02-15-36-36-f3bc0134b89662e9f8da9f9f93bd43d1.png" width="2846" height="1464" class="img_ev3q">
<img loading="lazy" src="/assets/images/2023-06-02-16-45-33-0e3a299560c01c85a6c4bde72ed1fc09.png" width="3022" height="1712" class="img_ev3q"></p><p>原因：less 编译导致耗时
参考：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- [vite2.x issues](https://github.com/vitejs/vite/issues/3673)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><a href="https://www.cnblogs.com/hetaojs/p/15386371.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/hetaojs/p/15386371.html</a></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="产品页面优化">产品页面优化<a href="#产品页面优化" class="hash-link" aria-label="产品页面优化的直接链接" title="产品页面优化的直接链接">​</a></h3><p>优化前</p><p>首页：66 requests 4.9 MB transferred 4.1 MB resources Finish: 369 ms</p><p>开启gzip后：66 requests 1.7 MB transferred 4.1 MB resources Finish: 462 ms DOMContentLoaded: 411 ms Load: 457 ms</p><p>mobile
<img loading="lazy" src="/assets/images/2023-06-19-15-18-30-7ca4c87e15899c815b0305195ac81687.png" width="3020" height="1792" class="img_ev3q">
<img loading="lazy" src="/assets/images/2023-06-21-11-33-01-3465592f965e80a41755aff2182172e2.png" width="1902" height="1398" class="img_ev3q"></p><p>mobile 开启 gzip 后：</p><p><img loading="lazy" src="/assets/images/2023-06-25-14-38-23-09ea7cbdddec42f502a97f88f9167aea.png" width="2612" height="1448" class="img_ev3q"></p><p>desktop
<img loading="lazy" src="/assets/images/2023-06-25-11-43-59-b5ff736b6f17df1781be7a08d60264da.png" width="3020" height="1794" class="img_ev3q"></p><p>desktop 开启 gzip 后：
<img loading="lazy" src="/assets/images/2023-06-25-14-31-01-e45bdc25730ebe94144bc1562dbe32f6.png" width="3022" height="1786" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="可优化点">可优化点<a href="#可优化点" class="hash-link" aria-label="可优化点的直接链接" title="可优化点的直接链接">​</a></h3><ul><li><p>gzip 开启压缩</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 其他配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_comp_level 9; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #  -1 --fast            fastest (worst) compression</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #  -9 --best            best (slowest) compression</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_min_length 256; # 大于 256 才开启压缩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_proxied any; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_vary on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_types </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        application/javascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        application/xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text/css</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text/plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text/xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text/javascript;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Header 中返回的 Content-Encoding: gzip</li></ul></li><li><p>HTTP2</p><ul><li>服务器（Nginx、Apache）支持</li><li>浏览器支持</li><li>服务支持</li></ul></li><li><p>懒加载 </p></li></ul><p>参考</p><ul><li><a href="https://time.geekbang.org/column/article/118826" target="_blank" rel="noopener noreferrer">06 | 渲染流程（下）：HTML、CSS和JavaScript，是如何变成页面的？</a></li><li><a href="https://time.geekbang.org/column/article/140703" target="_blank" rel="noopener noreferrer">23 | 渲染流水线：CSS如何影响首次加载时的白屏时间？</a></li><li><a href="https://time.geekbang.org/column/article/143889" target="_blank" rel="noopener noreferrer">25 | 页面性能：如何系统地优化页面</a></li><li><a href="https://time.geekbang.org/column/article/174254" target="_blank" rel="noopener noreferrer">加餐三｜加载阶段性能：使用Audits来优化Web性能</a></li><li><a href="https://time.geekbang.org/column/article/148546" target="_blank" rel="noopener noreferrer">30｜HTTP/2：如何提升网络速度？</a></li><li><a href="https://segmentfault.com/a/1190000016975064" target="_blank" rel="noopener noreferrer">HTTP/2协议“多路复用”实现原理</a></li><li><a href="https://juejin.cn/post/6844904083212468238#heading-2" target="_blank" rel="noopener noreferrer">重排(reflow)和重绘(repaint)</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/web-performance">Web Performance</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/FE/npm_module_privatization"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">在第三方模块中修改使用</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/FE/web_security"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">浏览器安全</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lighthouse" class="table-of-contents__link toc-highlight">Lighthouse</a></li><li><a href="#页面性能如何系统地优化页面" class="table-of-contents__link toc-highlight">页面性能：如何系统地优化页面？</a><ul><li><a href="#加载阶段-白屏优化" class="table-of-contents__link toc-highlight">加载阶段 白屏优化</a></li><li><a href="#交互阶段" class="table-of-contents__link toc-highlight">交互阶段</a></li></ul></li><li><a href="#实践" class="table-of-contents__link toc-highlight">实践</a><ul><li><a href="#产品页面优化" class="table-of-contents__link toc-highlight">产品页面优化</a></li><li><a href="#可优化点" class="table-of-contents__link toc-highlight">可优化点</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn/user/870468940997319" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/huangzonggui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9bbf9b1a.js"></script>
<script src="/assets/js/main.ba5ceb0e.js"></script>
</body>
</html>